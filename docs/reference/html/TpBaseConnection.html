<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<title>TpBaseConnection</title>
<meta name="generator" content="DocBook XSL Stylesheets V1.73.2">
<link rel="start" href="index.html" title="telepathy-glib Reference Manual">
<link rel="up" href="base-classes.html" title="Connections and channels">
<link rel="prev" href="telepathy-glib-TpChannelIface.html" title="TpChannelIface">
<link rel="next" href="TpBaseConnectionManager.html" title="TpBaseConnectionManager">
<meta name="generator" content="GTK-Doc V1.9 (XML mode)">
<link rel="stylesheet" href="style.css" type="text/css">
<link rel="chapter" href="ch-dbus.html" title="D-Bus interfaces">
<link rel="chapter" href="base-classes.html" title="Connections and channels">
<link rel="chapter" href="ch-mixins.html" title="Implementation mixins">
<link rel="chapter" href="ch-utilities.html" title="Utilities">
<link rel="chapter" href="ch-handle-management.html" title="Handle management">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<table class="navigation" id="top" width="100%" summary="Navigation header" cellpadding="2" cellspacing="2">
<tr valign="middle">
<td><a accesskey="p" href="telepathy-glib-TpChannelIface.html"><img src="left.png" width="24" height="24" border="0" alt="Prev"></a></td>
<td><a accesskey="u" href="base-classes.html"><img src="up.png" width="24" height="24" border="0" alt="Up"></a></td>
<td><a accesskey="h" href="index.html"><img src="home.png" width="24" height="24" border="0" alt="Home"></a></td>
<th width="100%" align="center">telepathy-glib Reference Manual</th>
<td><a accesskey="n" href="TpBaseConnectionManager.html"><img src="right.png" width="24" height="24" border="0" alt="Next"></a></td>
</tr>
<tr><td colspan="5" class="shortcuts"><nobr><a href="#id2604190" class="shortcut">Top</a>
                  &#160;|&#160;
                  <a href="#id2644110" class="shortcut">Description</a>
                  &#160;|&#160;
                  <a href="#id2644009" class="shortcut">Object Hierarchy</a>
                  &#160;|&#160;
                  <a href="#id2644032" class="shortcut">Implemented Interfaces</a>
                  &#160;|&#160;
                  <a href="#id2644054" class="shortcut">Properties</a>
                  &#160;|&#160;
                  <a href="#id2644085" class="shortcut">Signals</a></nobr></td></tr>
</table>
<div class="refentry" lang="en">
<a name="TpBaseConnection"></a><div class="titlepage"></div>
<div class="refnamediv"><table width="100%"><tr>
<td valign="top">
<h2>
<a name="id2604190"></a><span class="refentrytitle">TpBaseConnection</span>
</h2>
<p>TpBaseConnection &#8212; base class for <a class="link" href="telepathy-glib-svc-connection.html#TpSvcConnection"><span class="type">TpSvcConnection</span></a> implementations</p>
</td>
<td valign="top" align="right"></td>
</tr></table></div>
<div class="refsynopsisdiv">
<h2>Synopsis</h2>
<pre class="synopsis">

#include &lt;telepathy-glib/base-connection.h&gt;


#define             <a class="link" href="TpBaseConnection.html#TP-INTERNAL-CONNECTION-STATUS-NEW:CAPS">TP_INTERNAL_CONNECTION_STATUS_NEW</a>
                    <a class="link" href="TpBaseConnection.html#TpBaseConnection-struct">TpBaseConnection</a>;
                    <a class="link" href="TpBaseConnection.html#TpBaseConnectionClass">TpBaseConnectionClass</a>;
GPtrArray*          (<a class="link" href="TpBaseConnection.html#TpBaseConnectionCreateChannelFactoriesImpl">*TpBaseConnectionCreateChannelFactoriesImpl</a>)
                                                        (<a class="link" href="TpBaseConnection.html" title="TpBaseConnection">TpBaseConnection</a> *self);
void                (<a class="link" href="TpBaseConnection.html#TpBaseConnectionCreateHandleReposImpl">*TpBaseConnectionCreateHandleReposImpl</a>)
                                                        (<a class="link" href="TpBaseConnection.html" title="TpBaseConnection">TpBaseConnection</a> *self,
                                                         <a class="link" href="telepathy-glib-handle-repo.html#TpHandleRepoIface">TpHandleRepoIface</a> *repos[NUM_TP_HANDLE_TYPES]);
gchar*              (<a class="link" href="TpBaseConnection.html#TpBaseConnectionGetUniqueConnectionNameImpl">*TpBaseConnectionGetUniqueConnectionNameImpl</a>)
                                                        (<a class="link" href="TpBaseConnection.html" title="TpBaseConnection">TpBaseConnection</a> *self);
void                (<a class="link" href="TpBaseConnection.html#TpBaseConnectionProc">*TpBaseConnectionProc</a>)             (<a class="link" href="TpBaseConnection.html" title="TpBaseConnection">TpBaseConnection</a> *self);
gboolean            (<a class="link" href="TpBaseConnection.html#TpBaseConnectionStartConnectingImpl">*TpBaseConnectionStartConnectingImpl</a>)
                                                        (<a class="link" href="TpBaseConnection.html" title="TpBaseConnection">TpBaseConnection</a> *self,
                                                         GError **error);
gboolean            <a class="link" href="TpBaseConnection.html#tp-base-connection-register">tp_base_connection_register</a>         (<a class="link" href="TpBaseConnection.html" title="TpBaseConnection">TpBaseConnection</a> *self,
                                                         const gchar *cm_name,
                                                         gchar **bus_name,
                                                         gchar **object_path,
                                                         GError **error);
<a class="link" href="telepathy-glib-handle-repo.html#TpHandleRepoIface">TpHandleRepoIface</a>*  <a class="link" href="TpBaseConnection.html#tp-base-connection-get-handles">tp_base_connection_get_handles</a>      (<a class="link" href="TpBaseConnection.html" title="TpBaseConnection">TpBaseConnection</a> *self,
                                                         <a class="link" href="telepathy-glib-enums.html#TpHandleType">TpHandleType</a> handle_type);
void                <a class="link" href="TpBaseConnection.html#tp-base-connection-change-status">tp_base_connection_change_status</a>    (<a class="link" href="TpBaseConnection.html" title="TpBaseConnection">TpBaseConnection</a> *self,
                                                         <a class="link" href="telepathy-glib-enums.html#TpConnectionStatus">TpConnectionStatus</a> status,
                                                         <a class="link" href="telepathy-glib-enums.html#TpConnectionStatusReason">TpConnectionStatusReason</a> reason);
void                <a class="link" href="TpBaseConnection.html#tp-base-connection-finish-shutdown">tp_base_connection_finish_shutdown</a>  (<a class="link" href="TpBaseConnection.html" title="TpBaseConnection">TpBaseConnection</a> *self);
void                <a class="link" href="TpBaseConnection.html#tp-base-connection-add-interfaces">tp_base_connection_add_interfaces</a>   (<a class="link" href="TpBaseConnection.html" title="TpBaseConnection">TpBaseConnection</a> *self,
                                                         const gchar **interfaces);
void                <a class="link" href="TpBaseConnection.html#tp-base-connection-dbus-request-handles">tp_base_connection_dbus_request_handles</a>
                                                        (<a class="link" href="telepathy-glib-svc-connection.html#TpSvcConnection">TpSvcConnection</a> *iface,
                                                         guint handle_type,
                                                         const gchar **names,
                                                         <a
href="/usr/share/gtk-doc/html/dbus-glib/dbus-glib-DBusGMethod.html#DBusGMethodInvocation"
>DBusGMethodInvocation</a> *context);
#define             <a class="link" href="TpBaseConnection.html#TP-CONN-BUS-NAME-BASE:CAPS">TP_CONN_BUS_NAME_BASE</a>
#define             <a class="link" href="TpBaseConnection.html#TP-CONN-OBJECT-PATH-BASE:CAPS">TP_CONN_OBJECT_PATH_BASE</a>
#define             <a class="link" href="TpBaseConnection.html#TP-BASE-CONNECTION-ERROR-IF-NOT-CONNECTED:CAPS">TP_BASE_CONNECTION_ERROR_IF_NOT_CONNECTED</a>(conn, context)

</pre>
</div>
<div class="refsect1" lang="en">
<a name="id2644009"></a><h2>Object Hierarchy</h2>
<pre class="synopsis">

  GObject
   +----TpBaseConnection
</pre>
</div>
<div class="refsect1" lang="en">
<a name="id2644032"></a><h2>Implemented Interfaces</h2>
<p>
TpBaseConnection implements
 <a class="link" href="telepathy-glib-svc-connection.html#TpSvcConnection">TpSvcConnection</a>.</p>
</div>
<div class="refsect1" lang="en">
<a name="id2644054"></a><h2>Properties</h2>
<pre class="synopsis">

  "<a class="link" href="TpBaseConnection.html#TpBaseConnection--protocol">protocol</a>"                 gchararray            : Read / Write / Construct Only
</pre>
</div>
<div class="refsect1" lang="en">
<a name="id2644085"></a><h2>Signals</h2>
<pre class="synopsis">

  "<a class="link" href="TpBaseConnection.html#TpBaseConnection-shutdown-finished">shutdown-finished</a>"                              : Run Last / Has Details
</pre>
</div>
<div class="refsect1" lang="en">
<a name="id2644110"></a><h2>Description</h2>
<p>
This base class makes it easier to write <a class="link" href="telepathy-glib-svc-connection.html#TpSvcConnection"><span class="type">TpSvcConnection</span></a> implementations
by managing connection status, channel factories and handle tracking.
A subclass should often not need to implement any of the Connection
methods itself.
</p>
<p>
However, methods may be reimplemented if needed: for instance, Gabble
overrides RequestHandles so it can validate MUC rooms, which must be done
asynchronously.</p>
<p>

</p>
</div>
<div class="refsect1" lang="en">
<a name="id2644146"></a><h2>Details</h2>
<div class="refsect2" lang="en">
<a name="id2644157"></a><h3>
<a name="TP-INTERNAL-CONNECTION-STATUS-NEW:CAPS"></a>TP_INTERNAL_CONNECTION_STATUS_NEW</h3>
<a class="indexterm" name="id2644170"></a><pre class="programlisting">#   define TP_INTERNAL_CONNECTION_STATUS_NEW ((TpConnectionStatus)(-1))
</pre>
<p>
A special value for <a class="link" href="telepathy-glib-enums.html#TpConnectionStatus"><span class="type">TpConnectionStatus</span></a>, used within GLib connection
managers to indicate that the connection is disconnected because
connection has never been attempted (as distinct from disconnected
after connection has started, either by user request or an error).
</p>
<p>
Must never be visible on the D-Bus - <a class="link" href="telepathy-glib-enums.html#TP-CONNECTION-STATUS-DISCONNECTED:CAPS"><code class="literal">TP_CONNECTION_STATUS_DISCONNECTED</code></a>
is sent instead.</p>
<p>

</p>
</div>
<hr>
<div class="refsect2" lang="en">
<a name="id2644214"></a><h3>
<a name="TpBaseConnection-struct"></a>TpBaseConnection</h3>
<a class="indexterm" name="id2644226"></a><pre class="programlisting">typedef struct {
    GObject parent;

    gchar *bus_name;
    gchar *object_path;

    TpConnectionStatus status;

    TpHandle self_handle;
} TpBaseConnection;
</pre>
<p>
Data structure representing a generic <a class="link" href="telepathy-glib-svc-connection.html#TpSvcConnection"><span class="type">TpSvcConnection</span></a> implementation.
</p>
<p>
In addition to the fields documented here, there are four gpointer fields
which must currently be <code class="literal">NULL</code> (a meaning may be defined for these in a
future version of telepathy-glib), and a pointer to opaque private data.</p>
<p>

</p>
<div class="variablelist"><table border="0">
<col align="left" valign="top">
<tbody>
<tr>
<td><p><span class="term">GObject&#160;<em class="structfield"><code>parent</code></em>;</span></p></td>
<td> Fields shared by the superclass.
</td>
</tr>
<tr>
<td><p><span class="term">gchar&#160;*<em class="structfield"><code>bus_name</code></em>;</span></p></td>
<td> A D-Bus well-known bus name, owned by the connection manager
 process and associated with this connection. Set by
 tp_base_connection_register; should be considered read-only by subclasses.
</td>
</tr>
<tr>
<td><p><span class="term">gchar&#160;*<em class="structfield"><code>object_path</code></em>;</span></p></td>
<td> The object-path of this connection. Set by
 tp_base_connection_register; should be considered read-only by subclasses.
</td>
</tr>
<tr>
<td><p><span class="term"><a class="link" href="telepathy-glib-enums.html#TpConnectionStatus">TpConnectionStatus</a>&#160;<em class="structfield"><code>status</code></em>;</span></p></td>
<td> Connection status - may either be a valid TpConnectionStatus or
 TP_INTERNAL_CONNECTION_STATUS_NEW. Should be considered read-only by
 subclasses: use <a class="link" href="TpBaseConnection.html#tp-base-connection-change-status"><code class="function">tp_base_connection_change_status()</code></a> to set it.
</td>
</tr>
<tr>
<td><p><span class="term"><a class="link" href="telepathy-glib-handle.html#TpHandle">TpHandle</a>&#160;<em class="structfield"><code>self_handle</code></em>;</span></p></td>
<td> The handle of type <a class="link" href="telepathy-glib-enums.html#TP-HANDLE-TYPE-CONTACT:CAPS"><code class="literal">TP_HANDLE_TYPE_CONTACT</code></a> representing the
 local user. Must be set nonzero by the subclass before moving to state
 CONNECTED. If nonzero, the connection must hold a reference to the handle.
</td>
</tr>
</tbody>
</table></div>
</div>
<hr>
<div class="refsect2" lang="en">
<a name="id2633824"></a><h3>
<a name="TpBaseConnectionClass"></a>TpBaseConnectionClass</h3>
<a class="indexterm" name="id2633836"></a><pre class="programlisting">typedef struct {
    GObjectClass parent_class;

    TpBaseConnectionCreateHandleReposImpl create_handle_repos;

    TpBaseConnectionCreateChannelFactoriesImpl create_channel_factories;

    TpBaseConnectionGetUniqueConnectionNameImpl get_unique_connection_name;

    TpBaseConnectionProc connecting;
    TpBaseConnectionProc connected;
    TpBaseConnectionProc disconnected;

    TpBaseConnectionProc shut_down;

    TpBaseConnectionStartConnectingImpl start_connecting;

    const gchar **interfaces_always_present;
} TpBaseConnectionClass;
</pre>
<p>
The class of a <a class="link" href="TpBaseConnection.html" title="TpBaseConnection"><span class="type">TpBaseConnection</span></a>. Many members are virtual methods etc.
to be filled in in the subclass' class_init function.
</p>
<p>
In addition to the fields documented here, there are four gpointer fields
which must currently be <code class="literal">NULL</code> (a meaning may be defined for these in a
future version of telepathy-glib), and a pointer to opaque private data.</p>
<p>

</p>
<div class="variablelist"><table border="0">
<col align="left" valign="top">
<tbody>
<tr>
<td><p><span class="term">GObjectClass&#160;<em class="structfield"><code>parent_class</code></em>;</span></p></td>
<td> The superclass' structure
</td>
</tr>
<tr>
<td><p><span class="term"><a class="link" href="TpBaseConnection.html#TpBaseConnectionCreateHandleReposImpl">TpBaseConnectionCreateHandleReposImpl</a>&#160;<em class="structfield"><code>create_handle_repos</code></em>;</span></p></td>
<td> Fill in suitable handle repositories in the
 given array for all those handle types this Connection supports.
 Must be set by subclasses to a non-<code class="literal">NULL</code> value; the function must create
 at least a CONTACT handle repository (failing to do so will cause a crash).
</td>
</tr>
<tr>
<td><p><span class="term"><a class="link" href="TpBaseConnection.html#TpBaseConnectionCreateChannelFactoriesImpl">TpBaseConnectionCreateChannelFactoriesImpl</a>&#160;<em class="structfield"><code>create_channel_factories</code></em>;</span></p></td>
<td> Create an array of channel factories for this
 Connection. Must be set by subclasses to a non-<code class="literal">NULL</code> value.
</td>
</tr>
<tr>
<td><p><span class="term"><a class="link" href="TpBaseConnection.html#TpBaseConnectionGetUniqueConnectionNameImpl">TpBaseConnectionGetUniqueConnectionNameImpl</a>&#160;<em class="structfield"><code>get_unique_connection_name</code></em>;</span></p></td>
<td> Construct a unique name for this connection
 (for example using the protocol's format for usernames). If <code class="literal">NULL</code> (the
 default), a unique name will be generated. Subclasses should usually
 override this to get more obvious names, to aid debugging and prevent
 multiple connections to the same account.
</td>
</tr>
<tr>
<td><p><span class="term"><a class="link" href="TpBaseConnection.html#TpBaseConnectionProc">TpBaseConnectionProc</a>&#160;<em class="structfield"><code>connecting</code></em>;</span></p></td>
<td> If set by subclasses, will be called just after the state
 changes to CONNECTING. May be <code class="literal">NULL</code> if nothing special needs to happen.
</td>
</tr>
<tr>
<td><p><span class="term"><a class="link" href="TpBaseConnection.html#TpBaseConnectionProc">TpBaseConnectionProc</a>&#160;<em class="structfield"><code>connected</code></em>;</span></p></td>
<td> If set by subclasses, will be called just after the state
 changes to CONNECTED. May be <code class="literal">NULL</code> if nothing special needs to happen.
</td>
</tr>
<tr>
<td><p><span class="term"><a class="link" href="TpBaseConnection.html#TpBaseConnectionProc">TpBaseConnectionProc</a>&#160;<em class="structfield"><code>disconnected</code></em>;</span></p></td>
<td> If set by subclasses, will be called just after the state
 changes to DISCONNECTED. May be <code class="literal">NULL</code> if nothing special needs to happen.
</td>
</tr>
<tr>
<td><p><span class="term"><a class="link" href="TpBaseConnection.html#TpBaseConnectionProc">TpBaseConnectionProc</a>&#160;<em class="structfield"><code>shut_down</code></em>;</span></p></td>
<td> Called after <code class="function">disconnected()</code> is called, to clean up the
 connection. Must start the shutdown process for the underlying
 network connection, and arrange for <a class="link" href="TpBaseConnection.html#tp-base-connection-finish-shutdown"><code class="function">tp_base_connection_finish_shutdown()</code></a>
 to be called after the underlying connection has been closed. May not
 be left as <code class="literal">NULL</code>.
</td>
</tr>
<tr>
<td><p><span class="term"><a class="link" href="TpBaseConnection.html#TpBaseConnectionStartConnectingImpl">TpBaseConnectionStartConnectingImpl</a>&#160;<em class="structfield"><code>start_connecting</code></em>;</span></p></td>
<td> Asynchronously start connecting - called to implement
 the Connect D-Bus method. See <a class="link" href="TpBaseConnection.html#TpBaseConnectionStartConnectingImpl"><span class="type">TpBaseConnectionStartConnectingImpl</span></a> for
 details.
</td>
</tr>
<tr>
<td><p><span class="term">const&#160;gchar&#160;**<em class="structfield"><code>interfaces_always_present</code></em>;</span></p></td>
<td> A strv of extra D-Bus interfaces which are
 always implemented by instances of this class, which may be filled in
 by subclasses. The default is to list no additional interfaces.
 Individual instances may detect which additional interfaces they support
 and signal them before going to state CONNECTED by calling
 <a class="link" href="TpBaseConnection.html#tp-base-connection-add-interfaces"><code class="function">tp_base_connection_add_interfaces()</code></a>.
</td>
</tr>
</tbody>
</table></div>
</div>
<hr>
<div class="refsect2" lang="en">
<a name="id2634663"></a><h3>
<a name="TpBaseConnectionCreateChannelFactoriesImpl"></a>TpBaseConnectionCreateChannelFactoriesImpl ()</h3>
<a class="indexterm" name="id2634678"></a><pre class="programlisting">GPtrArray*          (*TpBaseConnectionCreateChannelFactoriesImpl)
                                                        (<a class="link" href="TpBaseConnection.html" title="TpBaseConnection">TpBaseConnection</a> *self);</pre>
<p>
Signature of an implementation of the create_handle_repos method
of <a class="link" href="TpBaseConnection.html" title="TpBaseConnection"><span class="type">TpBaseConnection</span></a>.</p>
<p>

</p>
<div class="variablelist"><table border="0">
<col align="left" valign="top">
<tbody>
<tr>
<td><p><span class="term"><em class="parameter"><code>self</code></em>&#160;:</span></p></td>
<td> The implementation, a subclass of TpBaseConnection
</td>
</tr>
<tr>
<td><p><span class="term"><span class="emphasis"><em>Returns</em></span>&#160;:</span></p></td>
<td> a GPtrArray of objects implementing <a class="link" href="telepathy-glib-TpChannelFactoryIface.html#TpChannelFactoryIface"><span class="type">TpChannelFactoryIface</span></a>
which, between them, implement all channel types this Connection
supports.
</td>
</tr>
</tbody>
</table></div>
</div>
<hr>
<div class="refsect2" lang="en">
<a name="id2634757"></a><h3>
<a name="TpBaseConnectionCreateHandleReposImpl"></a>TpBaseConnectionCreateHandleReposImpl ()</h3>
<a class="indexterm" name="id2634770"></a><pre class="programlisting">void                (*TpBaseConnectionCreateHandleReposImpl)
                                                        (<a class="link" href="TpBaseConnection.html" title="TpBaseConnection">TpBaseConnection</a> *self,
                                                         <a class="link" href="telepathy-glib-handle-repo.html#TpHandleRepoIface">TpHandleRepoIface</a> *repos[NUM_TP_HANDLE_TYPES]);</pre>
<p>
Signature of an implementation of the create_handle_repos method
of <a class="link" href="TpBaseConnection.html" title="TpBaseConnection"><span class="type">TpBaseConnection</span></a>.</p>
<p>

</p>
<div class="variablelist"><table border="0">
<col align="left" valign="top">
<tbody>
<tr>
<td><p><span class="term"><em class="parameter"><code>self</code></em>&#160;:</span></p></td>
<td> The connection object
</td>
</tr>
<tr>
<td><p><span class="term"><em class="parameter"><code>repos</code></em>&#160;:</span></p></td>
<td> An array of pointers to be filled in; the implementation
        may assume all are initially NULL.
</td>
</tr>
</tbody>
</table></div>
</div>
<hr>
<div class="refsect2" lang="en">
<a name="id2634853"></a><h3>
<a name="TpBaseConnectionGetUniqueConnectionNameImpl"></a>TpBaseConnectionGetUniqueConnectionNameImpl ()</h3>
<a class="indexterm" name="id2634868"></a><pre class="programlisting">gchar*              (*TpBaseConnectionGetUniqueConnectionNameImpl)
                                                        (<a class="link" href="TpBaseConnection.html" title="TpBaseConnection">TpBaseConnection</a> *self);</pre>
<p>
Signature of the <em class="parameter"><code>get_unique_connection_name</code></em> virtual method
on <a class="link" href="TpBaseConnection.html" title="TpBaseConnection"><span class="type">TpBaseConnection</span></a>.</p>
<p>

</p>
<div class="variablelist"><table border="0">
<col align="left" valign="top">
<tbody>
<tr>
<td><p><span class="term"><em class="parameter"><code>self</code></em>&#160;:</span></p></td>
<td> The implementation, a subclass of TpBaseConnection
</td>
</tr>
<tr>
<td><p><span class="term"><span class="emphasis"><em>Returns</em></span>&#160;:</span></p></td>
<td> a name for this connection which will be unique within this
connection manager process, as a string which the caller must free
with <span class="type">g_free</span>.
</td>
</tr>
</tbody>
</table></div>
</div>
<hr>
<div class="refsect2" lang="en">
<a name="id2634953"></a><h3>
<a name="TpBaseConnectionProc"></a>TpBaseConnectionProc ()</h3>
<a class="indexterm" name="id2634964"></a><pre class="programlisting">void                (*TpBaseConnectionProc)             (<a class="link" href="TpBaseConnection.html" title="TpBaseConnection">TpBaseConnection</a> *self);</pre>
<p>
Signature of a virtual method on <a class="link" href="TpBaseConnection.html" title="TpBaseConnection"><span class="type">TpBaseConnection</span></a> that takes no
additional parameters and returns nothing.</p>
<p>

</p>
<div class="variablelist"><table border="0">
<col align="left" valign="top">
<tbody><tr>
<td><p><span class="term"><em class="parameter"><code>self</code></em>&#160;:</span></p></td>
<td> The connection object
</td>
</tr></tbody>
</table></div>
</div>
<hr>
<div class="refsect2" lang="en">
<a name="id2635022"></a><h3>
<a name="TpBaseConnectionStartConnectingImpl"></a>TpBaseConnectionStartConnectingImpl ()</h3>
<a class="indexterm" name="id2635036"></a><pre class="programlisting">gboolean            (*TpBaseConnectionStartConnectingImpl)
                                                        (<a class="link" href="TpBaseConnection.html" title="TpBaseConnection">TpBaseConnection</a> *self,
                                                         GError **error);</pre>
<p>
Signature of an implementation of the start_connecting method
of <a class="link" href="TpBaseConnection.html" title="TpBaseConnection"><span class="type">TpBaseConnection</span></a>.
</p>
<p>
On entry, the implementation may assume that it is in state NEW.
</p>
<p>
If <code class="literal">TRUE</code> is returned, the Connect D-Bus method succeeds; the
implementation must either have already set the status to CONNECTED by
calling <a class="link" href="TpBaseConnection.html#tp-base-connection-change-status"><code class="function">tp_base_connection_change_status()</code></a>, or have arranged for a
status change to either state DISCONNECTED or CONNECTED to be signalled by
calling <a class="link" href="TpBaseConnection.html#tp-base-connection-change-status"><code class="function">tp_base_connection_change_status()</code></a> at some later time.
If the status is still NEW after returning <code class="literal">TRUE</code>, <a class="link" href="TpBaseConnection.html" title="TpBaseConnection"><span class="type">TpBaseConnection</span></a> will
automatically change it to CONNECTING for reason REQUESTED.
</p>
<p>
If <code class="literal">FALSE</code> is returned, the error will be raised from Connect as an
exception. If the status is not DISCONNECTED after <code class="literal">FALSE</code> is returned,
<a class="link" href="TpBaseConnection.html" title="TpBaseConnection"><span class="type">TpBaseConnection</span></a> will automatically change it to DISCONNECTED
with a reason appropriate to the error; NetworkError results in
NETWORK_ERROR, PermissionDenied results in AUTHENTICATION_FAILED, and all
other errors currently result in NONE_SPECIFIED.
</p>
<p>
All except the simplest connection managers are expected to implement this
asynchronously, returning <code class="literal">TRUE</code> in most cases and changing the status
to CONNECTED or DISCONNECTED later.</p>
<p>

</p>
<div class="variablelist"><table border="0">
<col align="left" valign="top">
<tbody>
<tr>
<td><p><span class="term"><em class="parameter"><code>self</code></em>&#160;:</span></p></td>
<td> The connection object
</td>
</tr>
<tr>
<td><p><span class="term"><em class="parameter"><code>error</code></em>&#160;:</span></p></td>
<td> Set to the error if <code class="literal">FALSE</code> is returned
</td>
</tr>
<tr>
<td><p><span class="term"><span class="emphasis"><em>Returns</em></span>&#160;:</span></p></td>
<td> <code class="literal">FALSE</code> if failure has already occurred, else <code class="literal">TRUE</code>.
</td>
</tr>
</tbody>
</table></div>
</div>
<hr>
<div class="refsect2" lang="en">
<a name="id2635266"></a><h3>
<a name="tp-base-connection-register"></a>tp_base_connection_register ()</h3>
<a class="indexterm" name="id2635278"></a><pre class="programlisting">gboolean            tp_base_connection_register         (<a class="link" href="TpBaseConnection.html" title="TpBaseConnection">TpBaseConnection</a> *self,
                                                         const gchar *cm_name,
                                                         gchar **bus_name,
                                                         gchar **object_path,
                                                         GError **error);</pre>
<p>
Make the connection object appear on the bus, returning the bus
name and object path used. If <code class="literal">TRUE</code> is returned, the connection owns the
bus name, and will release it when destroyed.</p>
<p>

</p>
<div class="variablelist"><table border="0">
<col align="left" valign="top">
<tbody>
<tr>
<td><p><span class="term"><em class="parameter"><code>self</code></em>&#160;:</span></p></td>
<td> A connection
</td>
</tr>
<tr>
<td><p><span class="term"><em class="parameter"><code>cm_name</code></em>&#160;:</span></p></td>
<td> The name of the connection manager in the Telepathy protocol
</td>
</tr>
<tr>
<td><p><span class="term"><em class="parameter"><code>bus_name</code></em>&#160;:</span></p></td>
<td> Used to return the bus name corresponding to the connection
 if <code class="literal">TRUE</code> is returned; must not be <code class="literal">NULL</code>. To be freed by the caller.
</td>
</tr>
<tr>
<td><p><span class="term"><em class="parameter"><code>object_path</code></em>&#160;:</span></p></td>
<td> Used to return the object path of the connection if
 <code class="literal">TRUE</code> is returned; must not be <code class="literal">NULL</code>. To be freed by the caller.
</td>
</tr>
<tr>
<td><p><span class="term"><em class="parameter"><code>error</code></em>&#160;:</span></p></td>
<td> Used to return an error if <code class="literal">FALSE</code> is returned; may be <code class="literal">NULL</code>
</td>
</tr>
<tr>
<td><p><span class="term"><span class="emphasis"><em>Returns</em></span>&#160;:</span></p></td>
<td> <code class="literal">TRUE</code> on success, <code class="literal">FALSE</code> on error.
</td>
</tr>
</tbody>
</table></div>
</div>
<hr>
<div class="refsect2" lang="en">
<a name="id2681074"></a><h3>
<a name="tp-base-connection-get-handles"></a>tp_base_connection_get_handles ()</h3>
<a class="indexterm" name="id2681086"></a><pre class="programlisting"><a class="link" href="telepathy-glib-handle-repo.html#TpHandleRepoIface">TpHandleRepoIface</a>*  tp_base_connection_get_handles      (<a class="link" href="TpBaseConnection.html" title="TpBaseConnection">TpBaseConnection</a> *self,
                                                         <a class="link" href="telepathy-glib-enums.html#TpHandleType">TpHandleType</a> handle_type);</pre>
<p>
</p>
<p>

</p>
<div class="variablelist"><table border="0">
<col align="left" valign="top">
<tbody>
<tr>
<td><p><span class="term"><em class="parameter"><code>self</code></em>&#160;:</span></p></td>
<td> A connection
</td>
</tr>
<tr>
<td><p><span class="term"><em class="parameter"><code>handle_type</code></em>&#160;:</span></p></td>
<td> The handle type
</td>
</tr>
<tr>
<td><p><span class="term"><span class="emphasis"><em>Returns</em></span>&#160;:</span></p></td>
<td> the handle repository corresponding to the given handle type,
or <span class="type">NULL</span> if it's unsupported or invalid.
</td>
</tr>
</tbody>
</table></div>
</div>
<hr>
<div class="refsect2" lang="en">
<a name="id2681169"></a><h3>
<a name="tp-base-connection-change-status"></a>tp_base_connection_change_status ()</h3>
<a class="indexterm" name="id2681181"></a><pre class="programlisting">void                tp_base_connection_change_status    (<a class="link" href="TpBaseConnection.html" title="TpBaseConnection">TpBaseConnection</a> *self,
                                                         <a class="link" href="telepathy-glib-enums.html#TpConnectionStatus">TpConnectionStatus</a> status,
                                                         <a class="link" href="telepathy-glib-enums.html#TpConnectionStatusReason">TpConnectionStatusReason</a> reason);</pre>
<p>
Change the status of the connection. The allowed state transitions are:
</p>
<p>
</p>
<div class="itemizedlist"><ul type="disc">
<li>NEW -&gt; CONNECTING</li>
<li>CONNECTING -&gt; CONNECTED</li>
<li>NEW -&gt; CONNECTED (equivalent to both of the above one after the
other - see below)</li>
<li>(anything except DISCONNECTED) -&gt; DISCONNECTED</li>
</ul></div>
<p>
</p>
<p>
Before the transition to CONNECTED, the implementation must have discovered
the handle for the local user, obtained a reference to that handle and
stored it in the <em class="parameter"><code>self_handle</code></em> member of <a class="link" href="TpBaseConnection.html" title="TpBaseConnection"><span class="type">TpBaseConnection</span></a>.
</p>
<p>
Changing from NEW to CONNECTED is implemented by doing the transition from
NEW to CONNECTING, followed by the transition from CONNECTING to CONNECTED;
it's exactly equivalent to calling tp_base_connection_change_status for
those two transitions one after the other.
</p>
<p>
Any other valid transition does the following, in this order:
</p>
<p>
</p>
<div class="itemizedlist"><ul type="disc">
<li>Update the <em class="parameter"><code>status</code></em> member of <a class="link" href="TpBaseConnection.html" title="TpBaseConnection"><span class="type">TpBaseConnection</span></a>
</li>
<li>If the new state is DISCONNECTED, call the close_all_channels
callback on all channel factories</li>
<li>If the new state is DISCONNECTED, unref the <em class="parameter"><code>self_handle</code></em>, if
any, and set it to 0</li>
<li>Emit the D-Bus StatusChanged signal</li>
<li>Call the subclass' status change callback</li>
<li>Call the channel factories' status change callbacks</li>
<li>If the new state is DISCONNECTED, call the subclass'
<em class="parameter"><code>shut_down</code></em> callback</li>
</ul></div>
<p>

</p>
<div class="variablelist"><table border="0">
<col align="left" valign="top">
<tbody>
<tr>
<td><p><span class="term"><em class="parameter"><code>self</code></em>&#160;:</span></p></td>
<td> The connection
</td>
</tr>
<tr>
<td><p><span class="term"><em class="parameter"><code>status</code></em>&#160;:</span></p></td>
<td> The new status
</td>
</tr>
<tr>
<td><p><span class="term"><em class="parameter"><code>reason</code></em>&#160;:</span></p></td>
<td> The reason for the status change
</td>
</tr>
</tbody>
</table></div>
</div>
<hr>
<div class="refsect2" lang="en">
<a name="id2681372"></a><h3>
<a name="tp-base-connection-finish-shutdown"></a>tp_base_connection_finish_shutdown ()</h3>
<a class="indexterm" name="id2681385"></a><pre class="programlisting">void                tp_base_connection_finish_shutdown  (<a class="link" href="TpBaseConnection.html" title="TpBaseConnection">TpBaseConnection</a> *self);</pre>
<p>
Tell the connection manager that this Connection has been disconnected,
has emitted StatusChanged and is ready to be removed from D-Bus.</p>
<p>

</p>
<div class="variablelist"><table border="0">
<col align="left" valign="top">
<tbody><tr>
<td><p><span class="term"><em class="parameter"><code>self</code></em>&#160;:</span></p></td>
<td> The connection
</td>
</tr></tbody>
</table></div>
</div>
<hr>
<div class="refsect2" lang="en">
<a name="id2681432"></a><h3>
<a name="tp-base-connection-add-interfaces"></a>tp_base_connection_add_interfaces ()</h3>
<a class="indexterm" name="id2681445"></a><pre class="programlisting">void                tp_base_connection_add_interfaces   (<a class="link" href="TpBaseConnection.html" title="TpBaseConnection">TpBaseConnection</a> *self,
                                                         const gchar **interfaces);</pre>
<p>
Add some interfaces to the list supported by this Connection. If you're
going to call this function at all, you must do so before moving to state
CONNECTED (or DISCONNECTED); if you don't call it, only the set of
interfaces always present (<em class="parameter"><code>interfaces_always_present</code></em> in
<a class="link" href="TpBaseConnection.html#TpBaseConnectionClass"><span class="type">TpBaseConnectionClass</span></a>) will be supported.</p>
<p>

</p>
<div class="variablelist"><table border="0">
<col align="left" valign="top">
<tbody>
<tr>
<td><p><span class="term"><em class="parameter"><code>self</code></em>&#160;:</span></p></td>
<td> A TpBaseConnection in state <a class="link" href="TpBaseConnection.html#TP-INTERNAL-CONNECTION-STATUS-NEW:CAPS"><span class="type">TP_INTERNAL_CONNECTION_STATUS_NEW</span></a>
 or <a class="link" href="telepathy-glib-enums.html#TP-CONNECTION-STATUS-CONNECTING:CAPS"><span class="type">TP_CONNECTION_STATUS_CONNECTING</span></a>
</td>
</tr>
<tr>
<td><p><span class="term"><em class="parameter"><code>interfaces</code></em>&#160;:</span></p></td>
<td> A <code class="literal">NULL</code>-terminated array of D-Bus interface names, which
 must remain valid at least until the connection enters state
 <a class="link" href="telepathy-glib-enums.html#TP-CONNECTION-STATUS-DISCONNECTED:CAPS"><span class="type">TP_CONNECTION_STATUS_DISCONNECTED</span></a> (in practice, you should either
 use static strings, or use strdup'd strings and free them in the dispose
 callback).
</td>
</tr>
</tbody>
</table></div>
</div>
<hr>
<div class="refsect2" lang="en">
<a name="id2681560"></a><h3>
<a name="tp-base-connection-dbus-request-handles"></a>tp_base_connection_dbus_request_handles ()</h3>
<a class="indexterm" name="id2681573"></a><pre class="programlisting">void                tp_base_connection_dbus_request_handles
                                                        (<a class="link" href="telepathy-glib-svc-connection.html#TpSvcConnection">TpSvcConnection</a> *iface,
                                                         guint handle_type,
                                                         const gchar **names,
                                                         <a
href="/usr/share/gtk-doc/html/dbus-glib/dbus-glib-DBusGMethod.html#DBusGMethodInvocation"
>DBusGMethodInvocation</a> *context);</pre>
<p>
Implements D-Bus method RequestHandles on interface
org.freedesktop.Telepathy.Connection. Exported so subclasses can
use it as a basis for their own implementations (for instance,
at the time of writing Gabble's GabbleConnection does its own processing
for room handles, in order to validate them asynchronously, but delegates
to this implementation for all other types).</p>
<p>

</p>
<div class="variablelist"><table border="0">
<col align="left" valign="top">
<tbody>
<tr>
<td><p><span class="term"><em class="parameter"><code>iface</code></em>&#160;:</span></p></td>
<td> A pointer to <a class="link" href="TpBaseConnection.html" title="TpBaseConnection"><span class="type">TpBaseConnection</span></a>, cast to a pointer to
 <a class="link" href="telepathy-glib-svc-connection.html#TpSvcConnection"><span class="type">TpSvcConnection</span></a>
</td>
</tr>
<tr>
<td><p><span class="term"><em class="parameter"><code>handle_type</code></em>&#160;:</span></p></td>
<td> The handle type (<a class="link" href="telepathy-glib-enums.html#TpHandleType"><span class="type">TpHandleType</span></a>) as a guint
</td>
</tr>
<tr>
<td><p><span class="term"><em class="parameter"><code>names</code></em>&#160;:</span></p></td>
<td> A strv of handle names
</td>
</tr>
<tr>
<td><p><span class="term"><em class="parameter"><code>context</code></em>&#160;:</span></p></td>
<td> The dbus-glib method invocation context
</td>
</tr>
</tbody>
</table></div>
</div>
<hr>
<div class="refsect2" lang="en">
<a name="id2681702"></a><h3>
<a name="TP-CONN-BUS-NAME-BASE:CAPS"></a>TP_CONN_BUS_NAME_BASE</h3>
<a class="indexterm" name="id2681712"></a><pre class="programlisting">#define TP_CONN_BUS_NAME_BASE "org.freedesktop.Telepathy.Connection."
</pre>
<p>
The prefix for a connection's bus name, to which the CM's name
(e.g. "gabble"), the protocol (e.g. "jabber") and an element or sequence
of elements representing the account should be appended.</p>
<p>

</p>
</div>
<hr>
<div class="refsect2" lang="en">
<a name="id2681734"></a><h3>
<a name="TP-CONN-OBJECT-PATH-BASE:CAPS"></a>TP_CONN_OBJECT_PATH_BASE</h3>
<a class="indexterm" name="id2681746"></a><pre class="programlisting">#define TP_CONN_OBJECT_PATH_BASE "/org/freedesktop/Telepathy/Connection/"
</pre>
<p>
The prefix for a connection's object path, to which the CM's name
(e.g. "gabble"), the protocol (e.g. "jabber") and an element or sequence
of elements representing the account should be appended.</p>
<p>

</p>
</div>
<hr>
<div class="refsect2" lang="en">
<a name="id2681768"></a><h3>
<a name="TP-BASE-CONNECTION-ERROR-IF-NOT-CONNECTED:CAPS"></a>TP_BASE_CONNECTION_ERROR_IF_NOT_CONNECTED()</h3>
<a class="indexterm" name="id2681781"></a><pre class="programlisting">#define             TP_BASE_CONNECTION_ERROR_IF_NOT_CONNECTED(conn, context)</pre>
<p>
If <em class="parameter"><code>conn</code></em> is not in state <a class="link" href="telepathy-glib-enums.html#TP-CONNECTION-STATUS-CONNECTED:CAPS"><span class="type">TP_CONNECTION_STATUS_CONNECTED</span></a>, complete the
D-Bus method invocation <em class="parameter"><code>context</code></em> by raising the Telepathy error
<a class="link" href="telepathy-glib-errors.html#TP-ERROR-DISCONNECTED:CAPS"><span class="type">TP_ERROR_DISCONNECTED</span></a>, and return from the current function (which
must be void). For use in D-Bus method implementations.</p>
<p>

</p>
<div class="variablelist"><table border="0">
<col align="left" valign="top">
<tbody>
<tr>
<td><p><span class="term"><em class="parameter"><code>conn</code></em>&#160;:</span></p></td>
<td> A TpBaseConnection
</td>
</tr>
<tr>
<td><p><span class="term"><em class="parameter"><code>context</code></em>&#160;:</span></p></td>
<td> A DBusGMethodInvocation
</td>
</tr>
</tbody>
</table></div>
</div>
</div>
<div class="refsect1" lang="en">
<a name="id2681857"></a><h2>Property Details</h2>
<div class="refsect2" lang="en">
<a name="id2681867"></a><h3>
<a name="TpBaseConnection--protocol"></a>The <code class="literal">"protocol"</code> property</h3>
<a class="indexterm" name="id2681879"></a><pre class="programlisting">  "protocol"                 gchararray            : Read / Write / Construct Only</pre>
<p>
Identifier used in the Telepathy protocol when this connection's protocol
name is required.</p>
<p>

</p>
<p>Default value: NULL</p>
</div>
</div>
<div class="refsect1" lang="en">
<a name="id2681909"></a><h2>Signal Details</h2>
<div class="refsect2" lang="en">
<a name="id2681918"></a><h3>
<a name="TpBaseConnection-shutdown-finished"></a>The <code class="literal">"shutdown-finished"</code> signal</h3>
<a class="indexterm" name="id2681932"></a><pre class="programlisting">void                user_function                      (<a class="link" href="TpBaseConnection.html" title="TpBaseConnection">TpBaseConnection</a> *arg0,
                                                        gpointer          user_data)      : Run Last / Has Details</pre>
<p>
Emitted by <a class="link" href="TpBaseConnection.html#tp-base-connection-finish-shutdown"><code class="function">tp_base_connection_finish_shutdown()</code></a> when the underlying
network connection has been closed; <a class="link" href="TpBaseConnectionManager.html" title="TpBaseConnectionManager"><span class="type">TpBaseConnectionManager</span></a> listens
for this signal and removes connections from its table of active
connections when it is received.</p>
<p>

</p>
<div class="variablelist"><table border="0">
<col align="left" valign="top">
<tbody><tr>
<td><p><span class="term"><em class="parameter"><code>user_data</code></em>&#160;:</span></p></td>
<td>user data set when the signal handler was connected.</td>
</tr></tbody>
</table></div>
</div>
</div>
<div class="refsect1" lang="en">
<a name="id2682005"></a><h2>See Also</h2>
<a class="link" href="TpBaseConnectionManager.html" title="TpBaseConnectionManager"><span class="type">TpBaseConnectionManager</span></a>, <a class="link" href="telepathy-glib-svc-connection.html#TpSvcConnection"><span class="type">TpSvcConnection</span></a>
</div>
<div class="refsect1" lang="en">
<a name="id2682024"></a><div class="refsect2" lang="en"><a name="id2682025"></a></div>
<hr>
<div class="refsect2" lang="en"><a name="id2682026"></a></div>
</div>
</div>
</body>
</html>
