#!/usr/bin/make -f

DEB_DH_MAKESHLIBS_ARGS_libtelepathy-glib0 := -V"libtelepathy-glib0 (>= 0.11.15)"

include /usr/share/cdbs/1/rules/utils.mk
include /usr/share/cdbs/1/class/autotools.mk
include /usr/share/cdbs/1/rules/debhelper.mk

# We don't want the .la files, but complain if anything else is missing
binary-post-install/libtelepathy-glib-dev::
	rm -f debian/tmp/usr/lib/*.la
common-binary-post-install-arch:: list-missing

DEB_DH_STRIP_ARGS := --dbg-package=libtelepathy-glib0-dbg

DEB_MAKE_CHECK_TARGET := check
DEB_CONFIGURE_EXTRA_FLAGS := \
	--disable-Werror \
	--enable-introspection \
	--enable-vala-bindings \
	--enable-gtk-doc \
	--with-html-dir=\$${prefix}/share/doc/libtelepathy-glib-doc

export DPKG_GENSYMBOLS_CHECK_LEVEL = 4

$(patsubst %,binary-predeb/%,$(DEB_ALL_PACKAGES)) ::
	dh_girepository -p$(cdbs_curpkg)

# we symlink many of the doc directories together
DEB_INSTALL_DOCS_ALL :=
DEB_INSTALL_DOCS_libtelepathy-glib0 := README NEWS AUTHORS
DEB_INSTALL_DOCS_libtelepathy-glib-doc := README NEWS AUTHORS
DEB_INSTALL_DOCS_libtelepathy-glib0-dbg := --link-doc=libtelepathy-glib0
DEB_INSTALL_DOCS_libtelepathy-glib-dev := --link-doc=libtelepathy-glib0
DEB_INSTALL_DOCS_gir1.0-telepathyglib-0.12 := --link-doc=libtelepathy-glib0

debian/stamp-buildinfo: insist-on-symlinks
insist-on-symlinks:
	for p in libtelepathy-glib0-dbg libtelepathy-glib-dev gir1.0-telepathyglib-0.12; do \
		install -d debian/$$p/usr/share/doc || exit $$?; \
		ln -s libtelepathy-glib0 debian/$$p/usr/share/doc/$$p || exit $$?; \
	done
